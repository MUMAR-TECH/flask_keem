{% extends "admin/base_admin.html" %}

{% block title %}Application #{{ application.id }} - KEEM Admin{% endblock %}
{% block page_title %}Application Details{% endblock %}
{% block page_description %}Application #{{ application.id }} - {{ application.first_name }} {{ application.last_name }}{% endblock %}

{% block content %}
<div class="p-6">
    <div class="mb-6">
        <a href="/admin/applications" class="text-red-600 hover:text-red-700 font-semibold">
            <i class="fas fa-arrow-left mr-2"></i>Back to Applications
        </a>
    </div>
    
    <div class="grid lg:grid-cols-3 gap-6">
        <!-- Main Details -->
        <div class="lg:col-span-2 space-y-6">
            <!-- Personal Information -->
            <div class="bg-white rounded-xl shadow-md p-6">
                <h3 class="text-xl font-bold mb-4 flex items-center">
                    <i class="fas fa-user mr-3 text-red-600"></i>
                    Personal Information
                </h3>
                <div class="grid md:grid-cols-2 gap-4">
                    <div>
                        <label class="text-sm font-semibold text-gray-600">Full Name</label>
                        <p class="text-gray-900">{{ application.first_name }} {{ application.last_name }}</p>
                    </div>
                    <div>
                        <label class="text-sm font-semibold text-gray-600">Email</label>
                        <p class="text-gray-900">{{ application.email }}</p>
                    </div>
                    <div>
                        <label class="text-sm font-semibold text-gray-600">Phone</label>
                        <p class="text-gray-900">{{ application.phone }}</p>
                    </div>
                    <div>
                        <label class="text-sm font-semibold text-gray-600">WhatsApp</label>
                        <p class="text-gray-900">{{ application.whatsapp }}</p>
                    </div>
                    <div>
                        <label class="text-sm font-semibold text-gray-600">Date of Birth</label>
                        <p class="text-gray-900">{{ application.date_of_birth }}</p>
                    </div>
                    <div>
                        <label class="text-sm font-semibold text-gray-600">Gender</label>
                        <p class="text-gray-900">{{ application.gender|title }}</p>
                    </div>
                    <div>
                        <label class="text-sm font-semibold text-gray-600">NRC Number</label>
                        <p class="text-gray-900">{{ application.nrc_number if application.nrc_number else 'Not provided' }}</p>
                    </div>
                    <div>
                        <label class="text-sm font-semibold text-gray-600">Preferred Language</label>
                        <p class="text-gray-900">{{ application.preferred_language }}</p>
                    </div>
                </div>
            </div>
            
            <!-- Address Information -->
            <div class="bg-white rounded-xl shadow-md p-6">
                <h3 class="text-xl font-bold mb-4 flex items-center">
                    <i class="fas fa-map-marker-alt mr-3 text-red-600"></i>
                    Address Information
                </h3>
                <div class="grid md:grid-cols-2 gap-4">
                    <div class="md:col-span-2">
                        <label class="text-sm font-semibold text-gray-600">Full Address</label>
                        <p class="text-gray-900">{{ application.address }}</p>
                    </div>
                    <div>
                        <label class="text-sm font-semibold text-gray-600">City</label>
                        <p class="text-gray-900">{{ application.city }}</p>
                    </div>
                    <div>
                        <label class="text-sm font-semibold text-gray-600">Province</label>
                        <p class="text-gray-900">{{ application.province }}</p>
                    </div>
                </div>
            </div>
            
            <!-- Course Information -->
            <div class="bg-white rounded-xl shadow-md p-6">
                <h3 class="text-xl font-bold mb-4 flex items-center">
                    <i class="fas fa-graduation-cap mr-3 text-red-600"></i>
                    Course Information
                </h3>
                <div class="grid md:grid-cols-2 gap-4">
                    <div>
                        <label class="text-sm font-semibold text-gray-600">Branch</label>
                        <p class="text-gray-900">{{ application.branch }}</p>
                    </div>
                    <div>
                        <label class="text-sm font-semibold text-gray-600">Course Type</label>
                        <p class="text-gray-900">{{ application.course_type }}</p>
                    </div>
                    <div class="md:col-span-2">
                        <label class="text-sm font-semibold text-gray-600">Previous Experience</label>
                        <p class="text-gray-900">{{ application.previous_experience if application.previous_experience else 'None' }}</p>
                    </div>
                </div>
            </div>
            
            <!-- Emergency Contact -->
            <div class="bg-white rounded-xl shadow-md p-6">
                <h3 class="text-xl font-bold mb-4 flex items-center">
                    <i class="fas fa-phone-alt mr-3 text-red-600"></i>
                    Emergency Contact
                </h3>
                <div class="grid md:grid-cols-2 gap-4">
                    <div>
                        <label class="text-sm font-semibold text-gray-600">Contact Name</label>
                        <p class="text-gray-900">{{ application.emergency_contact_name if application.emergency_contact_name else 'Not provided' }}</p>
                    </div>
                    <div>
                        <label class="text-sm font-semibold text-gray-600">Contact Phone</label>
                        <p class="text-gray-900">{{ application.emergency_contact_phone if application.emergency_contact_phone else 'Not provided' }}</p>
                    </div>
                </div>
            </div>
            
            <!-- Additional Information -->
            <div class="bg-white rounded-xl shadow-md p-6">
                <h3 class="text-xl font-bold mb-4 flex items-center">
                    <i class="fas fa-info-circle mr-3 text-red-600"></i>
                    Additional Information
                </h3>
                <div>
                    <label class="text-sm font-semibold text-gray-600">Medical Conditions</label>
                    <p class="text-gray-900">{{ application.medical_conditions if application.medical_conditions else 'None reported' }}</p>
                </div>
            </div>
        </div>
        
        <!-- Sidebar -->
        <div class="space-y-6">
            <!-- Status Card -->
            <div class="bg-white rounded-xl shadow-md p-6">
                <h3 class="text-lg font-bold mb-4">Application Status</h3>
                
                <div class="mb-4">
                    <label class="text-sm font-semibold text-gray-600 block mb-2">Current Status</label>
                    {% if application.status == 'pending' %}
                    <span class="px-4 py-2 inline-flex text-sm font-semibold rounded-full bg-yellow-100 text-yellow-800">
                        <i class="fas fa-clock mr-2"></i> Pending Review
                    </span>
                    {% elif application.status == 'accepted' %}
                    <span class="px-4 py-2 inline-flex text-sm font-semibold rounded-full bg-green-100 text-green-800">
                        <i class="fas fa-check-circle mr-2"></i> Accepted
                    </span>
                    {% elif application.status == 'rejected' %}
                    <span class="px-4 py-2 inline-flex text-sm font-semibold rounded-full bg-red-100 text-red-800">
                        <i class="fas fa-times-circle mr-2"></i> Rejected
                    </span>
                    {% endif %}
                </div>
                
                <div class="mb-4">
                    <label class="text-sm font-semibold text-gray-600">Applied On</label>
                    <p class="text-gray-900">{{ application.created_at.strftime('%B %d, %Y at %H:%M') }}</p>
                </div>
                
                {% if application.status == 'pending' %}
                <form method="POST" action="/admin/application/{{ application.id }}/update-status" class="space-y-4">
                    <div>
                        <label class="text-sm font-semibold text-gray-700 block mb-2">Update Status</label>
                        <select name="status" class="w-full px-4 py-2 border border-gray-300 rounded-lg" required>
                            <option value="accepted">Accept Application</option>
                            <option value="rejected">Reject Application</option>
                        </select>
                    </div>
                    
                    <div>
                        <label class="text-sm font-semibold text-gray-700 block mb-2">Notes (Optional)</label>
                        <textarea name="notes" rows="3" class="w-full px-4 py-2 border border-gray-300 rounded-lg" placeholder="Add any notes..."></textarea>
                    </div>
                    
                    <button type="submit" class="w-full bg-red-600 text-white py-2 rounded-lg font-semibold hover:bg-red-700 transition">
                        Update Status
                    </button>
                </form>
                {% endif %}
            </div>
            
            <!-- Profile Photo -->
            {% if application.profile_photo %}
            <div class="bg-white rounded-xl shadow-md p-6">
                <h3 class="text-lg font-bold mb-4">Profile Photo</h3>
                <img src="/static/uploads/{{ application.profile_photo }}" alt="Profile Photo" class="w-full rounded-lg">
            </div>
            {% endif %}
            
            <!-- Actions -->
            <div class="bg-white rounded-xl shadow-md p-6">
                <h3 class="text-lg font-bold mb-4">Actions</h3>
                <div class="space-y-3">
                    <a href="/admin/export/pdf/{{ application.id }}" class="block bg-red-100 text-red-600 text-center py-2 rounded-lg font-semibold hover:bg-red-200 transition">
                        <i class="fas fa-file-pdf mr-2"></i>Download PDF
                    </a>
                    <button onclick="window.print()" class="w-full bg-gray-100 text-gray-600 py-2 rounded-lg font-semibold hover:bg-gray-200 transition">
                        <i class="fas fa-print mr-2"></i>Print
                    </button>
                </div>
            </div>
            
            <!-- Admin Notes -->
            {% if application.admin_notes %}
            <div class="bg-white rounded-xl shadow-md p-6">
                <h3 class="text-lg font-bold mb-4">Admin Notes</h3>
                <p class="text-gray-700">{{ application.admin_notes }}</p>
            </div>
            {% endif %}
        </div>
    </div>
</div>
{% endblock %}